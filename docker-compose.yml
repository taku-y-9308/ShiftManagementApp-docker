version: '3.7'

services: 
  app: 
    build: ./django
    container_name: app
    volumes: 
      - ./django/:/usr/src/app/
      - gunicorn:/var/run/gunicorn
      - static:/usr/share/nginx/html/static

  web: 
    image: nginx:1.21.6
    container_name: web
    ports: 
     - 80:80
    depends_on: 
      - gunicorn
    volumes: 
     - ./nginx/gunicorn.conf:/etc/nginx/conf.d/default.conf
     - gunicorn:/var/run/gunicorn
     - static:/usr/share/nginx/html/static

  db:
    build: ./mysql
    container_name: db
    command: --default-authentication-plugin=mysql_native_password
    volumes:
      - db-store:/var/lib/mysql
  
volumes: 
  gunicorn: 
    driver: local
  db-store:
  static: